matrix:
    include:
        - language: rust
          cache: cargo
          before_script:
              - curl -L https://github.com/mozilla/grcov/releases/download/v0.4.1/grcov-linux-x86_64.tar.bz2 | tar jxf -
              # - rustup component add clippy --toolchain stable
          script:
              - cargo build --verbose --all
              - cargo test --verbose --all
              # - cargo clippy --verbose --all
              - ./grcov . -t lcov -o lcov.info
              - mkdir coverage && mkdir coverage/rust
              - mv ./lcov.info ./coverage/rust/lcov.info
          deploy:
              provider: pages
              skip_cleanup: true
              github_token: $GITHUB_TOKEN
              keep_history: true
              local_dir: coverage
              on:
                  branch: master

        - language: node_js
          node_js:
              - 'lts/*'
          cache:
              directories:
                  - node_modules

          before_script:
              - curl -L https://codeclimate.com/downloads/test-reporter/test-reporter-latest-linux-amd64 > ./cc-test-reporter
              - chmod +x ./cc-test-reporter
              - ./cc-test-reporter before-build

          script:
              - npm run test:coverage

          after_script:
              - ./cc-test-reporter after-build --exit-code $TRAVIS_TEST_RESULT
          deploy:
              provider: pages
              skip_cleanup: true
              github_token: $GITHUB_TOKEN
              keep_history: true
              local_dir: coverage
              on:
                  branch: master
after_script:
    - ls coverage
